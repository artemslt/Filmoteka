{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,SCCAC,EAAAD,EAAA,S,6FAUA,MAAME,iBAAEC,EAAgBC,eAAEC,EAAcC,SAAEC,EAAQC,eAAEC,EAAcC,cAAEC,GAAkBZ,EAAAa,KAIhFC,GA6GiBC,EA7GOC,SAASC,KAAKC,cA8GvB,KACV,EAELH,EAAc,IACT,EAEF,EAPT,IAAuBA,EA5GvB,IAAII,EAAeC,EAAAC,aAyBnB,SAASC,EAAyBC,EAAO,GACvC,IAAIC,EAAOC,EAAAC,gBAAgBC,KAAKP,EAAAQ,SAC7BC,EAAAC,KAAKC,aAAeN,EAAAC,gBAAgBC,KAAKP,EAAAY,cAC1CR,EAAOC,EAAAC,gBAAgBC,KAAKP,EAAAY,aAE1BR,EAONS,eAAkCV,GAChC,MAAMW,QAiCRD,eAAyCV,GACvC,MAAMY,EAmBR,SAAyBZ,GAGvB,OAQGM,EAAAC,KAAKC,aAAeN,EAAAC,gBAAgBC,KAAKP,EAAAY,YACnCP,EAAAC,gBAAgBC,KAAKP,EAAAY,YAAYb,GAEnCM,EAAAC,gBAAgBC,KAAKP,EAAAQ,SAAST,IAXrBiB,QAAO,CAACC,EAAOC,KAC7B,GAAIA,GAASxB,GAAWS,EAAO,IAAMe,EAAQxB,EAAUS,EACrD,OAAOc,CAAK,G,CAxBSE,CAAgBhB,GAEzC,GAAgC,IAA5BY,EAAiBK,OACnB,OAAO,KAGT,MAAMC,EAAgBN,EAAiBO,KAAIC,IAC3B,EAAAzC,EAAA0C,kBAAiBD,KAIjC,IACE,MAAME,QAAeC,QAAQC,IAAIN,GACjC,OAAO,EAAAO,EAAAC,SAAaJ,E,CACpB,MAAOK,GACPC,QAAQC,IAAIF,EAAEG,Q,EAjDKC,CAA0B/B,GAE/C,GAAIW,EAAQ,CAiGZxB,EAAe6C,UAAY,GA/FzB/C,EAAS+C,UAAYrB,EAGrB,MAAMsB,EAAM/B,EAAAC,gBAAgBC,KAAKP,EAAAQ,SAAST,GACpCsC,EAAaC,KAAKC,KAAKH,EAAIhB,OAAS1B,IAC1C,EAAA8C,EAAAC,kBAAiBtC,EAAMkC,GAGvBzC,SACG8C,iBAAiB,qBACjBC,SAAQC,GAAQA,EAAKC,iBAAiB,QAASC,EAAAC,kB,MAElDC,G,CAvBAC,CAAmB9C,GAEnB6C,G,CAyBJ,SAASA,IAmFP5D,EAAS+C,UAAY,GARrB3C,EAAc2C,UAAY,GAxEtBpC,IAAiBC,EAAAC,aAIjBF,IAAiBC,EAAAkD,aACnB5D,EAAe6C,UAAY,qDAJ3B7C,EAAe6C,UAAY,kD,CA3D/BnD,EAAiB6D,iBAAiB,SAKlC,WA+GQ7D,EAAiBmE,UAAUC,SAzHV,oBA0HrBpE,EAAiBmE,UAAUE,IA1HN,kBA2HrBnE,EAAeiE,UAAUG,OA3HJ,mBAavBvD,EAAeC,EAAAC,aAEfC,EAAyB,E,IAT3BhB,EAAe2D,iBAAiB,SAYhC,WA8GQ3D,EAAeiE,UAAUC,SAhIR,oBAiIrBlE,EAAeiE,UAAUE,IAjIJ,kBAkIrBrE,EAAiBmE,UAAUG,OAlIN,mBAqBvBvD,EAAeC,EAAAkD,WAEfhD,EAAyB,E,4FDzB3B,EAAAO,EAAA8C,cACE,CAACC,EAAAC,qBAAsBvD,GACvB,CAACsD,EAAAE,uBAAwBxD,IAG3BtB,EAAAa,KAAKF,cAAcsD,iBAAiB,SAASf,IACtCA,EAAE6B,OAAOC,QAAQzD,OACtB0D,OAAOC,SAAS,CACdC,IAAK,EACLC,KAAM,IAER9D,GAA0B4B,EAAE6B,OAAOC,QAAQzD,MAAK","sources":["src/js/library.js","src/js/library-main.js"],"sourcesContent":["import { refs } from './constants/refs';\nimport { renderLibraryMainContent } from './library-main';\nimport './modalCard';\nimport './modalAbout';\nimport './features/upToTop/upToTop';\nimport './features/auth/authModalWindowContent';\nimport { authObserver } from './api/firebase/api';\nimport {\n  showAuthorisedFields,\n  showUnauthorisedFields,\n} from './features/auth/authModalWindowContent';\n\nauthObserver(\n  [showAuthorisedFields, renderLibraryMainContent], \n  [showUnauthorisedFields, renderLibraryMainContent]);\n\n\nrefs.paginationBox.addEventListener('click', e => {\n  if (!e.target.dataset.page) return;\n  window.scrollTo({\n    top: 0,\n    left: 0,\n  });\n  renderLibraryMainContent(+e.target.dataset.page);\n});\n\nimport './features/theme-switcher/theme-switcher';\n","// imports\nimport { getMoviesDetails } from \"./api/moviedb/getMoviesDetails\";\nimport createMarkUp from '../templates/film-cards.hbs';\nimport { refs } from \"./constants/refs\";\nimport { STORAGE, ANON_WATCHED, ANON_QUEUE, DB_STORAGE } from \"./constants/storage\";\nimport { createPagination } from './pagination/createPagination';\nimport { onFilmCardClick } from './onFilmCardClick';\nimport { localStorageAPI } from './localStorageAPI';\nimport { auth } from './api/firebase/api';\n\n// references\nconst { headerWatchedBtn, headerQueueBtn, mainList, dataNotFoundEl, paginationBox } = refs;\n\n// variables\nconst ACCENT_BTN_CLASS = \"button--accent\";\nconst perPage = choisePerPage(document.body.clientWidth);\nlet libraryQuery = ANON_WATCHED;\n\n// event listeners\nheaderWatchedBtn.addEventListener('click', onClickWatched);\nheaderQueueBtn.addEventListener('click', onClickQueue);\n\n\n// event listeners functions\nfunction onClickWatched() {\n  accentWatchedBtn();\n  \n  libraryQuery = ANON_WATCHED;\n\n  renderLibraryMainContent(1);\n}\n\nfunction onClickQueue() {\n  accentQueueBtn();\n\n  libraryQuery = ANON_QUEUE;\n\n  renderLibraryMainContent(1);\n}\n\n// functions helpers\nfunction renderLibraryMainContent(page = 1) {\n  let data = localStorageAPI.load(STORAGE);\n  if(auth.currentUser && localStorageAPI.load(DB_STORAGE)){\n    data = localStorageAPI.load(DB_STORAGE);\n  }\n  if (data) {\n    renderLibraryCards(page);\n  } else {\n    renderEmptyLibrary();\n  }\n}\n\nasync function renderLibraryCards(page) {\n  const markup = await createLibraryCardsdMarkup(page);\n\n  if (markup) {\n    clearDataNotFoundEl();\n    mainList.innerHTML = markup;\n\n    // pagination\n    const arr = localStorageAPI.load(STORAGE)[libraryQuery];\n    const totalPages = Math.ceil(arr.length / perPage);\n    createPagination(page, totalPages);\n\n    // event listeners\n    document\n      .querySelectorAll('[data-modal-open]')\n      .forEach(card => card.addEventListener('click', onFilmCardClick));\n  } else {\n    renderEmptyLibrary();\n  }\n}\n\nfunction renderEmptyLibrary() {\n  clearLibraryCards();\n  clearPagination();\n  if (libraryQuery === ANON_WATCHED) {\n    dataNotFoundEl.innerHTML = `<p class=\"not-film-card\">Nothing watched yet</p>`;\n    return\n  }\n  if (libraryQuery === ANON_QUEUE) {\n    dataNotFoundEl.innerHTML = `<p class=\"not-film-card\">Nothing in queue yet</p>`;\n    return\n  }\n}\n\nasync function createLibraryCardsdMarkup(page) {\n  const filteredCardsArr = filterCardsdArr(page);\n\n  if (filteredCardsArr.length === 0) {\n    return null;\n  }\n\n  const moviePromises = filteredCardsArr.map(el => {\n    const movie = getMoviesDetails(el);\n    return movie;\n  })\n\n  try {\n    const movies = await Promise.all(moviePromises);\n    return createMarkUp(movies);\n  } catch (e) {\n    console.log(e.message);\n  }\n}\n\nfunction filterCardsdArr(page) {\n  const cardsArr = getLocalStorageFilms();\n\n  return cardsArr.filter((value, index) => {\n    if (index >= perPage * (page - 1) && index < perPage * page) {\n      return value;\n    }\n  })\n}\n\nfunction getLocalStorageFilms() {\n  if(auth.currentUser && localStorageAPI.load(DB_STORAGE)){\n    return localStorageAPI.load(DB_STORAGE)[libraryQuery];\n  }\n  return localStorageAPI.load(STORAGE)[libraryQuery];\n}\n\nfunction choisePerPage(screenWidth) {\n  if (screenWidth >= 1280) {\n    return 9;\n  }\n  if (screenWidth < 768) {\n    return 4;\n  }\n  return 8;\n}\n\nfunction accentWatchedBtn() {\n  if ( !headerWatchedBtn.classList.contains(ACCENT_BTN_CLASS)) {\n    headerWatchedBtn.classList.add(ACCENT_BTN_CLASS);\n    headerQueueBtn.classList.remove(ACCENT_BTN_CLASS);\n  }\n}\n\nfunction accentQueueBtn() {\n  if ( !headerQueueBtn.classList.contains(ACCENT_BTN_CLASS)) {\n    headerQueueBtn.classList.add(ACCENT_BTN_CLASS);\n    headerWatchedBtn.classList.remove(ACCENT_BTN_CLASS);\n  }\n}\n\nfunction clearPagination() {\n  paginationBox.innerHTML = '';\n}\n\nfunction clearDataNotFoundEl() {\n  dataNotFoundEl.innerHTML = '';\n}\n\nfunction clearLibraryCards() {\n  mainList.innerHTML = '';\n}\n\n// exports\nexport { renderLibraryMainContent };\n\n//authObserver(getUsersFilms, getLocalStorageFilms);"],"names":["$8N7ah","parcelRequire","$iaNpe","headerWatchedBtn","$dd78b310be7c5ac9$var$headerWatchedBtn","headerQueueBtn","$dd78b310be7c5ac9$var$headerQueueBtn","mainList","$dd78b310be7c5ac9$var$mainList","dataNotFoundEl","$dd78b310be7c5ac9$var$dataNotFoundEl","paginationBox","$dd78b310be7c5ac9$var$paginationBox","refs","$dd78b310be7c5ac9$var$perPage","screenWidth","document","body","clientWidth","$dd78b310be7c5ac9$var$libraryQuery","$jqFpy","ANON_WATCHED","$dd78b310be7c5ac9$export$243b4d1206135091","page","data","$kLGAr","localStorageAPI","load","STORAGE","$eAZYX","auth","currentUser","DB_STORAGE","async","markup","filteredCardsArr","filter","value","index","$dd78b310be7c5ac9$var$filterCardsdArr","length","moviePromises","map","el","getMoviesDetails","movies","Promise","all","$bJAXj","default","e","console","log","message","$dd78b310be7c5ac9$var$createLibraryCardsdMarkup","innerHTML","arr","totalPages","Math","ceil","$gBq5n","createPagination","querySelectorAll","forEach","card","addEventListener","$kApCy","onFilmCardClick","$dd78b310be7c5ac9$var$renderEmptyLibrary","$dd78b310be7c5ac9$var$renderLibraryCards","ANON_QUEUE","classList","contains","add","remove","authObserver","$kQePK","showAuthorisedFields","showUnauthorisedFields","target","dataset","window","scrollTo","top","left"],"version":3,"file":"library.74fdd592.js.map"}